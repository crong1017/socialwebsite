<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¡æ³¡ç³–ç¤¾äº¤</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="Client/js/styles.css"></script>
</head>
<body>
    <header class="header">
        <h1>æ³¡æ³¡ç³–ç¤¾äº¤</h1>
        <nav>
            <a href="register.html" class="profile-button">è¨»å†Š</a>
        </nav>
    </header>

    <!-- ç™»å…¥å€åŸŸ -->
    <div id="auth-section">
        <h2>ç™»å…¥</h2>
        <input id="login-email" type="email" placeholder="Email">
        <input id="login-password" type="password" placeholder="Password">
        <button onclick="login()">ç™»å…¥</button>
        <p>é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿ <a href="register.html">è¨»å†Š</a></p>
    </div>

    <!-- ç™¼æ–‡å€åŸŸï¼Œç™»å…¥å¾Œé¡¯ç¤º -->
    <div id="post-section" style="display: none;">
        <h2>å‰µå»ºæ–°è²¼æ–‡</h2>
        <textarea id="post-content" placeholder="ä½ åœ¨æƒ³ä»€éº¼ï¼Ÿ" rows="3"></textarea>
        <button onclick="createPost()">ç™¼è¡¨è²¼æ–‡</button>
        <div class="blog-container" id="feedContainer">
            <!-- è²¼æ–‡é¡¯ç¤ºå€åŸŸ -->
        </div>
    </div>

    <script>
        // åŠ å…¥ç™»å…¥åŠŸèƒ½
        async function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            // ä½¿ç”¨æ¨¡çµ„ä¸­çš„auth.jsä¾†æ¨¡æ“¬ç™»å…¥
            const response = await auth.login(email, password);
            if (response.success) {
                alert('ç™»å…¥æˆåŠŸï¼');
                document.getElementById('auth-section').style.display = 'none';
                document.getElementById('post-section').style.display = 'block';
                loadPosts(); // è¼‰å…¥è²¼æ–‡
            } else {
                alert(response.message || 'ç™»å…¥å¤±æ•—');
            }
        }

        // è²¼æ–‡åŠŸèƒ½
        async function createPost() {
            const content = document.getElementById('post-content').value;
            if (content) {
                // å‘¼å« API æ–°å¢è²¼æ–‡
                const response = await api.addLearningGoal(content);
                if (response.success) {
                    alert('ç™¼æ–‡æˆåŠŸï¼');
                    document.getElementById('post-content').value = '';
                    loadPosts(); // é‡æ–°è¼‰å…¥è²¼æ–‡
                } else {
                    alert('ç™¼æ–‡å¤±æ•—');
                }
            } else {
                alert('è«‹å¡«å¯«å…§å®¹');
            }
        }

        // è¼‰å…¥è²¼æ–‡
        async function loadPosts() {
            const feedContainer = document.getElementById('feedContainer');
            feedContainer.innerHTML = ''; // æ¸…ç©ºç¾æœ‰è²¼æ–‡
            const posts = await api.getDailyLearningList(); // å‡è¨­é€™å€‹æ–¹æ³•æ¨¡æ“¬è¼‰å…¥è²¼æ–‡
            posts.forEach((post) => {
                const postCard = document.createElement('div');
                postCard.className = 'post-card';
                postCard.innerHTML = `
                    <div class="post-content">
                        <p>${post.name}</p>
                        <span class="post-time">é€²åº¦ï¼š${post.progress}%</span>
                    </div>
                    <div class="interaction-buttons">
                        <button onclick="likePost(${post.id})">ğŸ‘ æŒ‰è®š</button>
                    </div>
                `;
                feedContainer.appendChild(postCard);
            });
        }

        // æ¨¡æ“¬æŒ‰è®šåŠŸèƒ½
        function likePost(postId) {
            alert(`æ‚¨å°è²¼æ–‡ ${postId} æŒ‰è®šï¼`);
        }
    </script>
</body>
</html>
