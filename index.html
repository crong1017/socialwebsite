<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¡æ³¡ç³–ç¤¾äº¤</title>
    <link rel="stylesheet" href="socialwebsite/Client/css/styles.css">
</head>
<body>
<header class="header">
    <h1>æ³¡æ³¡ç³–ç¤¾äº¤</h1>
    <nav>
        <a href="profile.html" class="profile-button">å€‹äººæª”æ¡ˆ</a>
    </nav>
</header>

<div class="post-section">
    <h2>å‰µå»ºæ–°è²¼æ–‡</h2>
    <textarea id="postContent" placeholder="ä½ åœ¨æƒ³ä»€éº¼ï¼Ÿ" rows="3"></textarea>
    <button onclick="createPost()">ç™¼è¡¨</button>
</div>

<div class="blog-container" id="feedContainer"></div>

<script>
    document.addEventListener("DOMContentLoaded", loadPosts);

    function createPost() {
        const content = document.getElementById('postContent').value;
        const user_id = 1; // å‡è¨­ä½¿ç”¨è€… ID å·²ç¶“å–å¾—ä¸¦å­˜å„²åœ¨æ­¤è™•ï¼Œå¯¦éš›æ‡‰å¾ç™»å…¥è³‡è¨Šä¸­å–å¾—

        if (content) {
            fetch('/createPost', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ user_id, content })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('ç™¼æ–‡æˆåŠŸï¼');
                    loadPosts(); // åˆ·æ–°è²¼æ–‡åˆ—è¡¨
                    document.getElementById('postContent').value = ''; // æ¸…ç©ºè¼¸å…¥æ¡†
                } else {
                    alert(result.message || 'ç™¼æ–‡å¤±æ•—ï¼Œè«‹é‡è©¦');
                }
            })
            .catch(error => {
                console.error('ç™¼æ–‡éŒ¯èª¤:', error);
                alert('ç™¼æ–‡å¤±æ•—ï¼Œè«‹æª¢æŸ¥ä¼ºæœå™¨é€£ç·š');
            });
        } else {
            alert('è«‹å¯«äº›å…§å®¹å†ç™¼è¡¨ï¼');
        }
    }

    function loadPosts() {
        const feedContainer = document.getElementById('feedContainer');
        feedContainer.innerHTML = '';
        const posts = JSON.parse(localStorage.getItem("posts")) || [];

        posts.forEach((post, index) => {
            const postCard = document.createElement('div');
            postCard.className = 'post-card';
            postCard.innerHTML = `
                <div class="post-content">
                    <p>${post.content}</p>
                    <span class="post-time">${post.time}</span>
                </div>
                <div class="interaction-buttons">
                    <button onclick="likePost(${index})">ğŸ‘ æŒ‰è®š (${post.likes})</button>
                    <button onclick="toggleCommentSection(${index})">ğŸ’¬ ç•™è¨€</button>
                </div>
                <div class="comments-section" id="comments-${index}" style="display: none;">
                    <textarea id="commentInput-${index}" placeholder="å¯«ä¸‹ä½ çš„ç•™è¨€..." rows="2"></textarea>
                    <button onclick="addComment(${index})">æ·»åŠ ç•™è¨€</button>
                    <div class="comments-list">
                        ${post.comments.map(comment => `<p>${comment}</p>`).join('')}
                    </div>
                </div>
            `;
            feedContainer.appendChild(postCard);
        });
    }

    function likePost(index) {
        const posts = JSON.parse(localStorage.getItem("posts"));
        posts[index].likes += 1;
        localStorage.setItem("posts", JSON.stringify(posts));
        loadPosts();
    }

    function toggleCommentSection(index) {
        const commentSection = document.getElementById(`comments-${index}`);
        commentSection.style.display = commentSection.style.display === "none" ? "block" : "none";
    }

    function addComment(index) {
        const commentInput = document.getElementById(`commentInput-${index}`);
        const comment = commentInput.value;
        if (comment) {
            const posts = JSON.parse(localStorage.getItem("posts"));
            posts[index].comments.push(comment);
            localStorage.setItem("posts", JSON.stringify(posts));
            commentInput.value = '';
            loadPosts();
        } else {
            alert('è«‹å¯«äº›å…§å®¹å†ç•™è¨€ï¼');
        }
    }
</script>


</body></html>
